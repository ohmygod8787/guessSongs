<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>猜歌大挑戰1/29-11:22</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { background-color: yellow; color: #fff; font-family: "Microsoft JhengHei", sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; user-select: none; }
        .game-container { text-align: center; width: 100%; max-width: 700px; padding: 20px; }
        #status-msg { color: #00AEEF; font-size: 16px; margin-bottom: 20px; min-height: 24px; font-weight: bold; }
        #song-display { color: #FF3B30; font-size: 32px; font-weight: 900; margin-bottom: 80px; min-height: 100px; line-height: 1.4; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; transition: opacity 0.3s; }
        .desktop-separator { margin: 0 15px; }
        .controls { display: flex; justify-content: space-around; align-items: center; margin-bottom: 100px; }
        .btn-box { cursor: pointer; transition: transform 0.2s; flex: 1; display: flex; justify-content: center; }
        .btn-box:active { transform: scale(0.9); }
        .icon { color: #FF3B30; font-size: 55px; }

        /* 底部功能區 */
        .footer { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
        .footer-row { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 10px; }
        .footer-left { display: flex; align-items: center; gap: 15px; }
        .restart-btn { color: #FF3B30; font-size: 40px; cursor: pointer; }
        
        .mode-btn {
            color: #FF3B30; font-size: 26px; width: 45px; height: 45px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; border: 3px solid transparent; transition: all 0.2s;
        }
        .mode-btn.active { border: 3px solid #FF3B30; border-radius: 8px; }

        .area-selector { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .area-checkbox { display: none; }
        .area-label {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 85px; height: 45px; border: 1px solid #00AEEF; color: #00AEEF; cursor: pointer; border-radius: 5px; transition: all 0.2s; line-height: 1.1;
        }
        .area-label .letter { font-size: 18px; font-weight: bold; }
        .area-label .years { font-size: 10px; margin-top: 2px; }
        .area-checkbox:checked + .area-label { background-color: #00AEEF; color: #1a1a1a; box-shadow: 0 0 10px rgba(0, 174, 239, 0.4); }

        /* 修改：讓播放器在手機版保持極小尺寸但在視線範圍內，並設置低透明度 */
        #yt-player-container { 
            position: fixed; 
            bottom: 0; 
            right: 0; 
            width: 1px; 
            height: 1px; 
            overflow: hidden; 
            opacity: 0.01;
            z-index: -1;
        }
        
        @media (max-width: 500px) { 
            #song-display { font-size: 26px; } 
            .desktop-separator { display: none !important; } 
            .footer-row { flex-direction: row; gap: 10px; }
            .area-label { width: 65px; height: 40px; }
            .area-label .letter { font-size: 16px; }
            .area-label .years { font-size: 9px; }
            .mode-btn { width: 38px; height: 38px; font-size: 22px; }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div id="status-msg">正在準備播放器...</div>
        <div id="song-display">
            <span id="display-info">載入中...</span>
            <span class="desktop-separator">-</span>
            <span id="display-title" class="song-title">歌曲名稱</span>
        </div>
        <div class="controls">
            <div class="btn-box" id="prev-btn"><i class="fas fa-step-backward icon"></i></div>
            <div class="btn-box" id="play-btn"><i class="fas fa-play icon" style="font-size: 65px;"></i></div>
            <div class="btn-box" id="next-btn"><i class="fas fa-step-forward icon"></i></div>
        </div>
        <div class="footer">
            <div class="footer-row">
                <div class="footer-left">
                    <i class="fas fa-rotate-right restart-btn" onclick="location.reload()" title="重新開始"></i>
                    <div class="mode-btn" id="btn-seq" title="依序播放"><i class="fas fa-list-ol"></i></div>
                    <div class="mode-btn" id="btn-rand" title="隨機播放"><i class="fas fa-shuffle"></i></div>
                </div>

                <div class="area-selector">
                    <input type="checkbox" id="area-a" class="area-checkbox" value="A" checked>
                    <label for="area-a" class="area-label"><span class="letter">A區</span><span class="years">1971-1980</span></label>
                    
                    <input type="checkbox" id="area-b" class="area-checkbox" value="B" checked>
                    <label for="area-b" class="area-label"><span class="letter">B區</span><span class="years">1981-1990</span></label>
                    
                    <input type="checkbox" id="area-c" class="area-checkbox" value="C" checked>
                    <label for="area-c" class="area-label"><span class="letter">C區</span><span class="years">1991-2000</span></label>
                    
                    <input type="checkbox" id="area-d" class="area-checkbox" value="D" checked>
                    <label for="area-d" class="area-label"><span class="letter">D區</span><span class="years">2001-2010</span></label>
                    
                    <input type="checkbox" id="area-e" class="area-checkbox" value="E" checked>
                    <label for="area-e" class="area-label"><span class="letter">E區</span><span class="years">2011-2024</span></label>
                </div>
            </div>
        </div>
    </div>

    <div id="yt-player-container"><div id="player"></div></div>

    <script>
        const songData = {
            "A": [
                { year: 1979, singer: "蔡琴", title: "恰似你的溫柔", ytId: "bs4Wz_b5p90", start: 70 },
                { year: 1972, singer: "甄妮", title: "誓言", ytId: "OhMWoeuBiWc", start: 52 },
                { year: 1979, singer: "潘安邦", title: "外婆的澎湖灣", ytId: "oqeC2vbrfsQ", start: 65 },
                { year: 1977, singer: "鄧麗君", title: "月亮代表我的心", ytId: "wOuFMIVBPlM", start: 61 },
                { year: 1977, singer: "鳳飛飛", title: "我是一片雲", ytId: "dOV7qboUU9c", start: 45 },
                { year: 1979, singer: "齊豫", title: "橄欖樹", ytId: "hEtX0rn8FjU", start: 47 },
                { year: 1973, singer: "歐陽菲菲", title: "熱情的沙漠", ytId: "cno9BFpdeGA", start: 40 },
                { year: 1971, singer: "楊小萍", title: "梨山痴情花", ytId: "ojiY0UgmRI8", start: 36 },
                { year: 1958, singer: "陳芬蘭", title: "孤女的願望(台)", ytId: "sL3mQgFk-hw", start: 44 },
                { year: 1960, singer: "文夏", title: "黃昏的故鄉(台)", ytId: "UehTlvCl_M0", start: 49 },
                { year: 1958, singer: "洪一峰", title: "思慕的人(台)", ytId: "KSMGPfKkIf8", start: 57 },
                { year: 1971, singer: "西卿", title: "苦海女神龍(台)", ytId: "bddzGfZt4hA", start: 42 },
                { year: 1980, singer: "尤雅", title: "等無人(台)", ytId: "FBj9qMMpWl0", start: 52 },
                { year: 1971, singer: "方瑞娥", title: "最後的火車站(台)", ytId: "1KotN2vrkmQ", start: 68 },
                { year: 1971, singer: "邱蘭芬", title: "走馬燈(台)", ytId: "GMYYuoI1dUo", start: 45 },
                { year: 1970, singer: "葉啟田", title: "內山姑娘要出嫁(台)", ytId: "14MUWf7AOlM", start: 58 },
                { year: 1959, singer: "郭金發", title: "燒肉粽(台)", ytId: "m45fUda0xP4", start: 47 },
                { year: 1980, singer: "陳盈潔", title: "期待再相會(台)", ytId: "hEKV8QQ_8DA", start: 51 },
                { year: 1972, singer: "西卿", title: "粉紅色的腰帶(台)", ytId: "iR3T4O8Yeso", start: 37 },
                { year: 1977, singer: "鳳飛飛", title: "心酸酸(台)", ytId: "0V-9JUF4tF0", start: 51 }
            ],
            "B": [
                { year: 1981, singer: "劉文正", title: "三月裡的小雨", ytId: "7-7x9ddaBX8", start: 38 },
                { year: 1983, singer: "費玉清", title: "一剪梅", ytId: "AjitR7RZEQU", start: 93 },
                { year: 1983, singer: "蘇芮", title: "一樣的月光", ytId: "dqcoG9LUzgE", start: 79 },
                { year: 1987, singer: "王傑", title: "一場遊戲一場夢", ytId: "MjtUQmhKGuI", start: 62 },
                { year: 1987, singer: "齊秦", title: "大約在冬季", ytId: "qztCjZLHYEg", start: 55 },
                { year: 1988, singer: "巫啟賢", title: "妳是我的唯一", ytId: "zgH0YaZW5og", start: 62 },
                { year: 1989, singer: "陳淑樺", title: "夢醒時分", ytId: "BWbAdL92jqU", start: 63 },
                { year: 1990, singer: "林憶蓮", title: "愛上一個不回家的人", ytId: "TM5HEICCAE8", start: 86 },
                { year: 1982, singer: "沈文程", title: "心事誰人知(台)", ytId: "sUipHah7SoU", start: 65 },
                { year: 1982, singer: "洪榮宏", title: "一支小雨傘(台)", ytId: "4N8jQXUilas", start: 54 },
                { year: 1984, singer: "江蕙", title: "惜別的海岸(台)", ytId: "FHPrSjpBSu0", start: 72 },
                { year: 1985, singer: "陳小雲", title: "舞女(台)", ytId: "mL8RXLb93-8", start: 33 },
                { year: 1986, singer: "李茂山", title: "今夜又擱塊下雨(台)", ytId: "VPb0t0Q9Ob4", start: 45 },
                { year: 1987, singer: "阿吉仔", title: "命運的吉他(台)", ytId: "sZb0eQeVt4c", start: 59 },
                { year: 1987, singer: "黃乙玲", title: "講什麼山盟海誓(台)", ytId: "XM96xW1cum0", start: 78 },
                { year: 1987, singer: "龍千玉", title: "不如甭熟識(台)", ytId: "ftEfcHy3Iu0", start: 73 },
                { year: 1988, singer: "葉啟田", title: "愛拼才會贏(台)", ytId: "rBiE1dNaSqg", start: 50 },
                { year: 1988, singer: "蔡秋鳳", title: "金包銀(台)", ytId: "6R2yfAOYRlw", start: 57 },
                { year: 1988, singer: "賀一航", title: "媽媽請你不通痛(台)", ytId: "ZU_Rg3NOIqY", start: 82 },
                { year: 1990, singer: "王瑞霞", title: "絕情雨(台)", ytId: "Y_sypl1xnDw", start: 60 }
            ],
            "C": [
                { year: 1991, singer: "張清芳", title: "加州陽光", ytId: "MUQokGdc_eo", start: 50 },
                { year: 1992, singer: "張雨生", title: "大海", ytId: "sL1NQyOhxAc", start: 65 },
                { year: 1993, singer: "王菲", title: "執迷不悔", ytId: "9KkvR1EatbE", start: 96 },
                { year: 1994, singer: "伍佰", title: "浪人情歌", ytId: "Ex9mW1mvgcw", start: 79 },
                { year: 1995, singer: "周華健", title: "朋友", ytId: "wip4VGh2z7U", start: 59 },
                { year: 1996, singer: "蘇慧倫", title: "鴨子", ytId: "mZmfzIjh0aM", start: 54 },
                { year: 1997, singer: "張惠妹", title: "聽海", ytId: "4ChZ82y8Tzo", start: 74 },
                { year: 1998, singer: "任賢齊", title: "傷心太平洋", ytId: "SeSbEc-HatQ", start: 93 },
                { year: 1999, singer: "陶喆", title: "找自己", ytId: "0jJbW4sdDHk", start: 83 },
                { year: 1999, singer: "蕭亞軒", title: "最熟悉的陌生人", ytId: "Td5e0kzVlZQ", start: 80 },
                { year: 2000, singer: "周杰倫", title: "星晴", ytId: "F3gGxA4SbhY", start: 75 },
                { year: 2000, singer: "孫燕姿", title: "天黑黑", ytId: "mrTSszvVF74", start: 78 },
                { year: 1991, singer: "林強", title: "向前走(台)", ytId: "4n4DPG2wn2c", start: 95 },
                { year: 1992, singer: "張秀卿", title: "車站(台)", ytId: "Kl5UE15Koio", start: 59 },
                { year: 1994, singer: "陳雷", title: "風真透(台)", ytId: "yolQ38EKlFc", start: 32 },
                { year: 1994, singer: "施文彬 & 江蕙", title: "傷心酒店(台)", ytId: "VwNZ4en7SmE", start: 55 },
                { year: 1998, singer: "動力火車", title: "我若不曾愛過你(台)", ytId: "mSmIF2PZe9k", start: 0 },
                { year: 1999, singer: "五月天", title: "志明與春嬌(台)", ytId: "MHL00KwcGlU", start: 62 },
                { year: 1999, singer: "五月天", title: "I Love You 無望(台)", ytId: "ArnP8KKsL7M", start: 60 },
                { year: 2000, singer: "江蕙", title: "家後", ytId: "6La0usd_dxU", start: 63 }
            ], "D": [], "E": []
        };

        let currentList = [], currentIndex = 0, player, isPlayerReady = false, stopTimer;
        let currentMode = 'rand'; 

        function switchMode(mode) {
            currentMode = mode;
            $(".mode-btn").removeClass("active");
            const selectedAreas = [];
            $(".area-checkbox:checked").each(function() { selectedAreas.push($(this).val()); });
            if (selectedAreas.length === 0) { alert("請至少勾選一個區域！"); return; }
            let filteredSongs = [];
            selectedAreas.forEach(area => { if (songData[area]) filteredSongs = filteredSongs.concat(songData[area]); });
            if (filteredSongs.length === 0) { alert("所選區域目前沒有歌單！"); return; }
            if (mode === 'seq') { $("#btn-seq").addClass("active"); currentList = filteredSongs; }
            else { $("#btn-rand").addClass("active"); currentList = [...filteredSongs].sort(() => Math.random() - 0.5); }
            currentIndex = 0;
            renderSong();
        }

        function renderSong() {
            if (currentList.length === 0 || !currentList[currentIndex]) return;
            const song = currentList[currentIndex];
            $("#song-display").css("opacity", 0);
            setTimeout(() => {
                $("#display-info").text(song.year + " - " + song.singer);
                $("#display-title").text(song.title);
                $("#song-display").css("opacity", 1);
            }, 200);
            if (isPlayerReady) player.stopVideo();
            clearTimeout(stopTimer);
            $("#status-msg").text("播放器就緒！").css("color", "#00AEEF");
        }

        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                height: '200', width: '200',
                playerVars: { 'autoplay': 0, 'controls': 0, 'rel': 0, 'playsinline': 1, 'origin': window.location.origin },
                events: {
                    'onReady': function() { isPlayerReady = true; $("#status-msg").text("播放器就緒！"); },
                    'onStateChange': function(event) {
                        if (event.data == 1) { // 開始播放
                            clearTimeout(stopTimer);
                            stopTimer = setTimeout(() => { player.pauseVideo(); }, 5000);
                        }
                    }
                }
            });
        };

        $(document).ready(function() {
            switchMode('rand');
            $("#btn-seq").click(() => switchMode('seq'));
            $("#btn-rand").click(() => switchMode('rand'));
            $(".area-checkbox").change(function() { switchMode(currentMode); });

            // 修改：播放邏輯修正，移除所有非同步延遲
            $("#play-btn").click(function() {
                if (!isPlayerReady) return;
                const song = currentList[currentIndex];
                if (!song || !song.ytId) { alert("尚未填入 ID！"); return; }
                
                // 關鍵：直接取消靜音並播放，不要放在 setTimeout 裡面
                player.unMute(); 
                player.setVolume(100);
                player.loadVideoById({ 
                    videoId: song.ytId, 
                    startSeconds: song.start 
                });
                // 某些手機需要顯式呼叫播放指令
                player.playVideo(); 
            });

            $("#next-btn").click(function() {
                if (currentIndex < currentList.length - 1) { currentIndex++; renderSong(); }
                else { alert("清單結束，將重新開始。"); switchMode(currentMode); }
            });
            $("#prev-btn").click(function() { if (currentIndex > 0) { currentIndex--; renderSong(); } });
        });

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>
</body>
</html>